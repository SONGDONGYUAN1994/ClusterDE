<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ClusterDE is a post-clustering DE method for controlling the false discovery rate (FDR) of identified DE genes regardless of clustering quality. The core idea of ClusterDE is to generate real-data-based synthetic null data with only one cluster, as a counterfactual in contrast to the real data, for evaluating the whole procedure of clustering followed by a DE test.">
<title>A Post-clustering Differential Expression (DE) Method For Solving Double Dipping • ClusterDE</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A Post-clustering Differential Expression (DE) Method For Solving Double Dipping">
<meta property="og:description" content="ClusterDE is a post-clustering DE method for controlling the false discovery rate (FDR) of identified DE genes regardless of clustering quality. The core idea of ClusterDE is to generate real-data-based synthetic null data with only one cluster, as a counterfactual in contrast to the real data, for evaluating the whole procedure of clustering followed by a DE test.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">ClusterDE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/ClusterDE-PBMC.html">Perform ClusterDE on a PBMC dataset</a>
    <a class="dropdown-item" href="articles/ClusterDE-cellline.html">Perform ClusterDE on a cell line dataset</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SONGDONGYUAN1994/ClusterDE/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level2">
<h2 id="clusterde">ClusterDE<a class="anchor" aria-label="anchor" href="#clusterde"></a>
</h2>
<hr>
<p>The R package <strong>ClusterDE</strong> is a post-clustering DE method for controlling the false discovery rate (FDR) of identified between cell-type DE genes regardless of clustering quality. The core idea of ClusterDE is to generate real-data-based synthetic null data with only one cell type, as contrast to the real data, for evaluating the whole procedure of clustering followed by a DE test. <span style="color:blue"> <strong>Detailed tutorials that illustrate various functionalities of ClusterDE are available at this <a href="https://songdongyuan1994.github.io/ClusterDE/docs/index.html">website</a></strong></span>. The following illustration figure summarizes the usage of ClusterDE:</p>
<p><img src="reference/figures/ClusterDE_illustration.png" width="600"></p>
<p>Instead of a new pipeline, ClusterDE actually works as an add-on to popular pipelines such as Seurat. To find out more details about <strong>ClusterDE</strong>, you can check out our manuscript on bioRxiv.</p>
<p><strong>The motivation and application of ClusterDE</strong>: In Seurat function <code>findMarkers</code>, the authors pointed out: <em>“p-values should be interpreted cautiously, as the genes used for clustering are the same genes tested for differential expression.”</em> This is the “double-dipping” issue. If your clustering results are inaccurate and since the clustering has used your expression data already, the discovered DE genes may not represent the discrete cell type separation, but other variations in your data.</p>
<p>ClusterDE is for correcting the double-dipping issue for comparing two dubious clusters, which you are not sure if they are two discrete cell types or just an artifact of your clustering algorithm based on conventional DE analysis. ClusterDE controls the false discoveries in DE and prioritizes the true cell type markers.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a name="installation-"></a>
<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To install the development version from GitHub, please run:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"SONGDONGYUAN1994/scDesign3"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"SONGDONGYUAN1994/ClusterDE"</span><span class="op">)</span></span></code></pre></div>
<p>Please note that ClusterDE is actually a wrapper of <strong>scDesign3</strong>. Therefore, you can also directly use scDesign3 to “design” your own synthetic null data. To better understand scDesign3, you can check out our manuscript on Nature Biotechnology:</p>
<p><a href="https://www.nature.com/articles/s41587-023-01772-1" class="external-link">Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic in silico data for multimodal single-cell and spatial omics. <em>Nat Biotechnol</em> (2023).</a></p>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a name="quick-start"></a>
<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<p>The following code is a quick example of how to generate the synthetic null data. The input data should be a gene by cell matrix containing the two clusters you want to compare. If your input matrix is count data (especially UMI counts), <code>nb</code> (Negative Binomial) is usually the appropriate choice. The synthetic null data generation is relatively time-consuming; you may use the fast version (<code>fastVersion = TRUE</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">exampleCounts</span><span class="op">)</span></span>
<span><span class="va">nullData</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/constructNull.html">constructNull</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">exampleCounts</span>,</span>
<span>                          family <span class="op">=</span> <span class="st">"nb"</span>,</span>
<span>                          nCores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          parallelization <span class="op">=</span> <span class="st">"pbmcmapply"</span>,</span>
<span>                          fastVersion <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          corrCut <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                          BPPARAM <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The parameters of <code><a href="reference/constructNull.html">constructNull()</a></code> are:</p>
<ul>
<li>
<code>mat</code>: The input gene by cell matrix. It can be a sparse matrix.</li>
<li>
<code>family</code>: A string of the distribution you want to use when fitting the model. Must be one of ‘poisson’, ‘nb’, ‘zip’, ‘zinb’ or ‘gaussian’.</li>
<li>
<code>nCores</code>: An integer. The number of cores to use. Increasing the cores will greatly speed up the computaion.</li>
<li>
<code>parallelization</code>: A string indicating the specific parallelization function to use. Must be one of ‘mcmapply’, ‘bpmapply’, or ‘pbmcmapply’, which corresponds to the parallelization function in the package ‘parallel’, ‘BiocParallel’, and ‘pbmcapply’ respectively. The default value is ‘pbmcmapply’.</li>
<li>
<code>fastVersion</code>: A logic value. If TRUE, the fast approximation is used.</li>
<li>
<code>corrCut</code>: A numeric value. The cutoff for non-zero proportions in genes used in modelling correlation.</li>
<li>
<code>BPPARAM</code>: A MulticoreParam object or NULL. When the parameter parallelization = ‘mcmapply’ or ‘pbmcmapply’, this parameter must be NULL. When the parameter parallelization = ‘bpmapply’, this parameter must be one of the MulticoreParam object offered by the package ‘BiocParallel’. The default value is NULL.</li>
</ul>
<p>The output of <code><a href="reference/constructNull.html">constructNull()</a></code> is the new gene by cell matrix in the same format as your input.</p>
<p>The following figure briefly describes how ClusterDE generates the synthetic null data:</p>
<p><img src="reference/figures/ClusterDE_supp_null_generation.png" width="800"></p>
<p>After obtaining the synthetic null data, you should <em>perform the same clustering procedure as you have done on your real data</em> to get the DE p-values (<code>nullPvalues</code>). Finally, we compare the p-values from the null and p-values from the target data (real data) by <code><a href="reference/callDE.html">callDE()</a></code>. For illustration, here we use the Uniform random numbers as the p-values.</p>
<pre class="{r}"><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">targetPvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">nullPvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">targetPvalues</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nullPvalues</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Gene"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/callDE.html">callDE</a></span><span class="op">(</span>targetScores <span class="op">=</span> <span class="va">targetPvalues</span>,</span>
<span>              nullScores <span class="op">=</span> <span class="va">nullPvalues</span>,</span>
<span>              nlogTrans <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              FDR <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>              correct <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
<p>The parameters of <code>callDE</code> are:</p>
<ul>
<li>
<code>targetScores</code>: A named numeric vector of the DE scores from the target data, e.g., the p-values between two clusters from the real data.</li>
<li>
<code>nullScores</code>: A named numeric vector of the DE scores from the synthetic null data, e.g., the p-values between two clusters from the null data.</li>
<li>
<code>nlogTrans</code>: A logical value. If the input scores are p-values, take the <code>-log10</code> transformation since Clipper require larger scores represent more significant DE. Default is TRUE.</li>
<li>
<code>FDR</code>: A numeric value of the target False Discovery Rate (FDR). Default is 0.05.</li>
<li>
<code>correct</code>: A logical value. If TRUE, perform the correction to make the distribution of contrast scores approximately symmetric. Default is FALSE.</li>
</ul>
<p>The output of <code>callDE</code> is a list of target FDR, DE genes, and the detailed summary table.</p>
</div>
<div class="section level2">
<h2 id="tutorials">Tutorials<a name="tutorials"></a>
<a class="anchor" aria-label="anchor" href="#tutorials"></a>
</h2>
<p>For all detailed tutorials, please check the <a href="https://songdongyuan1994.github.io/ClusterDE/docs/index.html">website</a>. The tutorials will demonstrate the applications of <strong>ClusterDE</strong> in two cases: a cell line dataset (no cell type exists) and a PBMC dataset.</p>
<ul>
<li><a href="https://songdongyuan1994.github.io/ClusterDE/docs/articles/ClusterDE-cellline.html">Perform ClusterDE on a cell line dataset</a></li>
<li><a href="https://songdongyuan1994.github.io/ClusterDE/docs/articles/ClusterDE-PBMC.html">Perform ClusterDE on a PBMC dataset</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="contact">Contact<a name="contact"></a>
<a class="anchor" aria-label="anchor" href="#contact"></a>
</h2>
<p>Any questions or suggestions on <code>ClusterDE</code> are welcomed! Please report it on <a href="https://github.com/SONGDONGYUAN1994/ClusterDE/issues" class="external-link">issues</a>, or contact Dongyuan Song (<a href="mailto:dongyuansong@ucla.edu" class="email">dongyuansong@ucla.edu</a>).</p>
</div>
<div class="section level2">
<h2 id="related-manuscripts">Related Manuscripts<a name="related-manuscripts"></a>
<a class="anchor" aria-label="anchor" href="#related-manuscripts"></a>
</h2>
<ul>
<li>
<strong>scDesign3</strong>: <a href="https://www.nature.com/articles/s41587-023-01772-1" class="external-link">Song, D., Wang, Q., Yan, G. et al. scDesign3 generates realistic in silico data for multimodal single-cell and spatial omics. <em>Nat Biotechnol</em> (2023).</a>
</li>
<li>
<strong>Clipper</strong>: <a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-021-02506-9" class="external-link">Ge, X., Chen, Y.E., Song, D. et al. Clipper: p-value-free FDR control on high-throughput data from two conditions. <em>Genome Biology</em> 22, 288 (2021).</a>
</li>
</ul>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/SONGDONGYUAN1994/ClusterDE/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/SONGDONGYUAN1994/ClusterDE/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ClusterDE</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Dongyuan Song <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1114-1215" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Kexin Li <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-4955-3832" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dongyuan Song, Kexin Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
